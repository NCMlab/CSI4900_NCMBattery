<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="jsPsych ANT">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Jason Steffener, NCMLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMS Block Based</title>
    <script src="../jspsych/dist/jspsych.js"></script>
    <script src="../jspsych/dist/plugin-html-keyboard-response.js"></script>
    <script src="../jspsych/dist/plugin-html-button-response.js"></script>
    <script src="../jspsych/dist/plugin-image-keyboard-response.js"></script>
    <script src="../jspsych/dist/plugin-preload.js"></script>
        
    <script src="../jspsych/dist/plugin-audio-keyboard-response.js"></script>
    <script src="../jspsych/dist/plugin-fullscreen.js"></script>
    <script src="../jspsych/dist/plugin-instructions.js"></script>    
    <script src="../jspsych_addons/plugin-html-button-response-touchscreen.js"></script>
    <script src="../jspsych_addons/plugin-html-numberpad-response.js"></script>
    <script src="../functions/DigitSpan_functions.js"></script>
    <script src="../functions/StairClass.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" />
    <link rel="stylesheet" type='text/css' href='../css/NCMLabGeneral.css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src='../config/Language_Config.js'>//Load language</script>
    <script> 
    // Based on the language set in the Language Config, the correct code is loaded up
        var url = "../config/"+Language+"/DigitSpan_Setup.js"
        document.write("\<script src='" + url + "'\>\</script\>");  
        var url = "../config/"+Language+"/General_Setup.js"
        document.write("\<script src='" + url + "'\>\</script\>");  
    </script>

  </head>
    <body>
    <div id="jspsych-target"  style="overflow:hidden; height:100%" class='center'></div>
  <script>

  
  let stair1 = new Stair(StartValue,MinValue,MaxValue,MaxReversals,MaxTrials,StepSize,NUp,NDown,FastStart);
  console.log(stair1)

  Stimuli = CreateDigitList(1)
  Input = MakeListOfStimuli(FolderOfAudioFiles, Stimuli)

  var jsPsych = initJsPsych({
    display_element: 'jspsych-target',
     on_interaction_data_update: function(data) {
        console.log(JSON.stringify(data))
    },
    on_finish: function() {
      //jsPsych.data.get().localSave('csv','StroopWordMydata.csv');
    }
  });

  var preload = {
    type: jsPsychPreload,
    auto_preload: true
  }

  var pre_audio = {
    type: jsPsychHtmlButtonResponse,
    stimulus: '<div style="max-width:600px;"><p>Some browsers now require the user to interact with a page before it can play audio. '+
    'Clicking the button below counts as an interaction.</p><p>Be aware of this when planning audio experiments if '+
    'you want the first trial to include audio.</p></div>',
    choices: ['Run demo']
  }

  var timeline = [];
  var trial = {
    type: jsPsychAudioKeyboardResponse,
    stimulus: MakeListOfStimuli(FolderOfAudioFiles, CreateDigitList(3)), 
    // stimulus: function() {
    //   var file = jsPsych.timelineVariable('file')
    //   return file;
    // },
    choices: ['e', 'i'],
    trial_duration: AudioDuration, 
    prompt: "<p>Is the pitch high or low? Press 'e' for low and 'i' for high.</p>",
    response_ends_trial: true
  };

  var NumberPadTrial = {
    type: jsPsychNumberPadResponse,
    //button_html: '<button class="jspsych-btn">%choice%</button>',
    button_html: '<button class="button" >%choice%</button>',
    stimulus: '<p style="font-size:24px; color:black;">GREEN</p>',
    choices: ['1','2','3','4','5','6','7','8','9','0','<i class="material-icons">backspace</i>','Enter'],
    margin_vertical: '4px',
    response_ends_trial: false,
    response_disables: false,
    prompt: "<p>What color is the ink?</p>",
    on_finish() {
      // get the entered response
      var trial_data = jsPsych.data.getLastTrialData().values();
      var response = trial_data[0].response;
      console.log(CheckResponse(Stimuli, response))
    }
  };


  var trial_procedure = {
      timeline: [trial],
      timeline_variables: Input,
      randomize_order: false,
      repetitions: 1,
    }



  var loop_node = {
      timeline: [trial_procedure, NumberPadTrial],
      loop_function: function(data){
      return (! stair1.Finished)
     }
    }
  timeline.push(pre_audio)
  timeline.push(loop_node)
  
  jsPsych.run(timeline)
</script>
  </body>
</html>