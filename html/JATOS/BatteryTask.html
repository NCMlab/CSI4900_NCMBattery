/* Customizable batteries with modifiable parameters 
The idea is to have one folder with all of the JATOS html tasks in it. Also included is a battery 'task.' This is a list of the tasks that will be presented to the participant. This can be the full battery or a subset. Ideally, there would be JSON parameters that can be passed to the batteries, such as number of trials.

The battery task has a list of teh tasks to do and after each button press of start the next task JATOS calls the component. At the end of teh task the user is brought back to the battery task. But now the completed task is removed from teh list.

Set study JSON input to be a list of tasks. The first component is a the Battery Task. This deciphers the JSON input and decides which component to run. At the end of the component JATOS returns to the Battry Task to see what the next component is. At the last component JATOS ends.

Instead of using the JSON study input, I can use the URL input. It would need some sort of shorthand coding and ideally some way to HASH/shorten the URL. 

There can be a site where the user types in the patient ID, clicks the tasks to administer and a specific URL is created. The battery component decodes the URL and identifies what tasks to do. It then generates the Component list.

A battery list is also possible. Instead of sending a list of component IDs, the URL just has battery ID that is sent alomng with teh participant ID.

http://localhost:9000/publix/MvEwRA6kh0q?Battery=1&ID=987654

*/

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <meta name="description" content="jsPsych Attention Network Test">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Jason Steffener, NCMLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCMLab: Attention Network Test</title>
    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" />
    <link rel="stylesheet" type='text/css' href='css/NCMLabGeneral.css'>
  </head>    
  <body>
    <script src="jatos.js"></script>
    <script src="jspsych/dist/jspsych.js"></script>
    <script src="jspsych/dist/plugin-fullscreen.js"></script>
    <script src="jspsych/dist/plugin-html-button-response.js"></script>
    <script src="jspsych_addons/plugin-html-button-response-touchscreen.js"></script>
    
    <script src="config/General_Setup.js"></script>
    <script src="config/ComponentList.js"></script>
    <script src='InstructionsAndStimuli/Language_Config.js'>//Load language</script>
    <script> 
    // Based on the language set in the Language Config, the correct code is loaded up
        var url = "InstructionsAndStimuli/"+Language+"/Instructions/AttentionNetworkTest_Instructions.js"
        document.write("\<script src='" + url + "'\>\</script\>");  
    </script>
    <script src="Batteries/BatteryOne.js"></script>
    <div id="jspsych-target"  style="overflow:hidden; height:100%" class='center'></div>
  </body>
  <script>
var GLOBALVARIABLE = "JASON"
var jsPsych = initJsPsych({
    display_element: 'jspsych-target',
    on_trial_start: function() {
      //http://127.0.0.1:9000/publix/fNTRhuguK1x
      // Add jatos info to the data file
      URLParameters = jatos.urlQueryParameters
      
      jsPsych.data.addProperties({Battery: URLParameters.Battery});
      jsPsych.data.addProperties({jatosWorkerID: jatos.workerId});
      jsPsych.data.addProperties({jatosBatchID: jatos.batchId});
      jsPsych.data.addProperties({jatosStudyName: jatos.studyProperties.title});
      jsPsych.data.addProperties({jatosTaskName: jatos.componentProperties.title});
    },
    on_finish: function() {
      jatos.endStudy(jsPsych.data.get().json())
      if ( SaveLocalFile ) {
        //jsPsych.data.get().localSave('csv','AttentionNetworkTest_data.csv');
      }    
      jatos.startNextComponent();
    }
  });




  jatos.onLoad(() => {
      var JATOSID = jatos.workerId;
      console.log(jatos)
      console.log(JATOSID)
      var resultsData = {'name':'JASON'};
      URLParameters = jatos.urlQueryParameters
      jsPsych.data.addProperties({Battery: URLParameters.Battery});
      BatteryNumber = URLParameters.Battery
      console.log(jsPsych.data)
      jatos.addJatosIds(resultsData);
      jatos.addAbortButton({
        text: "Quit",
        confirmText: "Do you really want to quit?",
        tooltip: "This will quit the entire experiment",
        msg: "This worker aborted the mission.",
        style: "top:8px; right:40px; color:green"
      });
      jsPsych.run(timeline);
    });
  </script>
</html>